(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{199:function(t,a,e){"use strict";e.r(a);var s=e(0),r=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content"},[e("h2",{attrs:{id:"cors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cors","aria-hidden":"true"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),e("p",[t._v("CORS 是一个 W3C 标准，全称是“跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨域的服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。")]),t._v(" "),e("h2",{attrs:{id:"分类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分类","aria-hidden":"true"}},[t._v("#")]),t._v(" 分类")]),t._v(" "),e("ul",[e("li",[t._v("简单请求\n同时满足以下两大条件，即为简单请求：\n"),e("ol",[e("li",[t._v("请求方法是HEAD,POST,GET")]),t._v(" "),e("li",[t._v("HTTP 的头信息不超出以下几种字段。")])]),t._v(" "),e("ul",[e("li",[t._v("Accept")]),t._v(" "),e("li",[t._v("Accept-Language")]),t._v(" "),e("li",[t._v("Content-Language")]),t._v(" "),e("li",[t._v("Last-Event-ID")]),t._v(" "),e("li",[t._v("Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain")])])]),t._v(" "),e("li",[t._v("非简单请求\n凡是不同时满足上面两个条件，就属于非简单请求。")])]),t._v(" "),e("h2",{attrs:{id:"简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简单请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),e("h3",{attrs:{id:"发送"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送","aria-hidden":"true"}},[t._v("#")]),t._v(" 发送")]),t._v(" "),e("p",[t._v("对于简单请求，浏览器直接发出 CORS 请求。具体来说，就是在头信息之中，增加一个Origin字段。\n例如：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("  GET /cors HTTP/1.1\n  Origin: http://api.bob.com\n  Host: api.alice.com\n  Accept-Language: en-US\n  Connection: keep-alive\n  User-Agent: Mozilla/5.0...\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("p",[t._v("上面的头信息中，Origin字段用来说明，本次请求来自哪个域（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。")]),t._v(" "),e("h3",{attrs:{id:"回应"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回应","aria-hidden":"true"}},[t._v("#")]),t._v(" 回应")]),t._v(" "),e("p",[t._v("如果Origin指定的源，不在许可范围内，服务器会返回一个正常的 HTTP 回应。浏览器发现，这个回应的头信息没有包含Access-Control-Allow-Origin字段，就知道出错了，从而抛出一个错误，被XMLHttpRequest的onerror回调函数捕获。注意，这种错误无法通过状态码识别，因为 HTTP 回应的状态码有可能是200。")]),t._v(" "),e("p",[t._v("如果Origin指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段。")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text/html; charset=utf-8\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("h2",{attrs:{id:"非简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求","aria-hidden":"true"}},[t._v("#")]),t._v(" 非简单请求")]),t._v(" "),e("p",[t._v("非简单请求是那种对服务器提出特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json。")]),t._v(" "),e("h3",{attrs:{id:"发送-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发送-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 发送")]),t._v(" "),e("p",[t._v("非简单请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为“预检”请求（preflight）。浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些 HTTP 动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的XMLHttpRequest请求，否则就报错。这是为了防止这些新增的请求，对传统的没有 CORS 支持的服务器形成压力，给服务器一个提前拒绝的机会，这样可以防止服务器大量收到DELETE和PUT请求，这些传统的表单不可能跨域发出的请求。")]),t._v(" "),e("h3",{attrs:{id:"回应-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回应-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 回应")]),t._v(" "),e("p",[t._v("服务器收到“预检”请求以后，检查了Origin、Access-Control-Request-Method和Access-Control-Request-Headers字段以后，确认允许跨源请求，就可以做出回应。")]),t._v(" "),e("p",[t._v("一旦服务器通过了“预检”请求，以后每次浏览器正常的 CORS 请求，就都跟简单请求一样，会有一个Origin头信息字段。服务器的回应，也都会有一个Access-Control-Allow-Origin头信息字段。")]),t._v(" "),e("p",[t._v("如果服务器否定了“预检”请求，会返回一个正常的 HTTP 回应，但是没有任何 CORS 相关的头信息字段，或者明确表示请求不符合条件。")])])}],!1,null,null,null);r.options.__file="cors.md";a.default=r.exports}}]);